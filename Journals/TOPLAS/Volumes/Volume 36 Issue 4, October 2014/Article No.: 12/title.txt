Foundations of Typestate-Oriented Programming