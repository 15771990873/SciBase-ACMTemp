Types for atomicity: Static checking and inference for Java