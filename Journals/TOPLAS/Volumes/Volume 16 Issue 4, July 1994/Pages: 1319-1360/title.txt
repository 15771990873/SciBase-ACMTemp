Optimally profiling and tracing programs