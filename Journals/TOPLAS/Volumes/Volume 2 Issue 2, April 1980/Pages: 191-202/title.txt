The Design and Application of a Retargetable Peephole Optimizer