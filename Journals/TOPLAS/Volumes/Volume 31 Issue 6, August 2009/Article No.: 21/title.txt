From datalog rules to efficient programs with time and space guarantees