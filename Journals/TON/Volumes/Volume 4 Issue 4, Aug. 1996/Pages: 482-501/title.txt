Efficient network QoS provisioning based on per node traffic shaping