Optimal scheduling and routing for maximum network throughput