Current IEEE 802.11 WLANs suffer from the well-knownrate anomalyproblem, which can drastically reduce network performance. Opportunistic relaying can address this problem, but three major considerations, typically considered separately by prior work, need to be taken into account for an efficient deployment in real-world systems: 1) relaying could imply increased power consumption, and nodes might be heterogeneous, both in power source (e.g., battery-powered versus socket-powered) and power consumption profile; 2) similarly, nodes in the network are expected to have heterogeneous throughput needs and preferences in terms of the throughput versus energy consumption tradeoff; and 3) any proposed solution should be backwards-compatible, given the large number of legacy 802.11 devices already present in existing networks. In this paper, we propose a novel framework, Self-Optimizing, Legacy-Compatible Opportunistic Relaying (SOLOR), which jointly takes into account the above considerations and greatly improves network performance even in systems comprised mostly of vanilla nodes and legacy access points. SOLOR jointly optimizes thetopologyof the network, i.e., which are the nodes associated to each relay-capable node; and therelay schedules, i.e., how the relays split time between the downstream nodes they relay for and the upstream flow to access points. Our results, obtained for a large variety of scenarios and different node preferences, illustrate the significant gains achieved by our approach. Specifically, SOLOR greatly improves network throughput performance (more than doubling it) and power consumption (up to 75% reduction) even in systems comprised mostly of vanilla nodes and legacy access points. Its feasibility is demonstrated through testbed experimentation in a realistic deployment.