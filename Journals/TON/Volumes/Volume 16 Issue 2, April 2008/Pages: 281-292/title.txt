Building heterogeneous peer-to-peer networks: protocol and analysis