Enhancing class-based service architectures with adaptive rate allocation and dropping mechanisms