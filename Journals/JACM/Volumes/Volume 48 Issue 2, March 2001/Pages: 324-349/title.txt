A general approach to dynamic packet routing with bounded buffers