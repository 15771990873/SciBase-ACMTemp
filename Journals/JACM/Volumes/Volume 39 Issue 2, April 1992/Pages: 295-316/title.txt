Nonlinear pattern matching in trees