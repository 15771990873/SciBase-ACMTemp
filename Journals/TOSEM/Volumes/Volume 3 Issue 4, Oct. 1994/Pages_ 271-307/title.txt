Formal specification and design of a message router