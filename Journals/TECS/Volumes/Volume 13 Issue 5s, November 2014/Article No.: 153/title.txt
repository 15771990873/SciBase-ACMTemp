Designing Trusted Embedded Systems from Finite State Machines