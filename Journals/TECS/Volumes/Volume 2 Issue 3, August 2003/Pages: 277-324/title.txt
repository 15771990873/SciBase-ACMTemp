Energy management for battery-powered embedded systems