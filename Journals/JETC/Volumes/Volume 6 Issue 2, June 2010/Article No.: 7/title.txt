An energy management framework for energy harvesting embedded systems