LegoSim: simulation of embedded kernels over Pthreads