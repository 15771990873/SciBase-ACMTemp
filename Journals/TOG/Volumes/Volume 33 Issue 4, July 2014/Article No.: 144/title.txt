Darkroom: compiling high-level image processing code into hardware pipelines