Using histories to implement atomic objects