A discipline for constructing multiphase communication protocols