Balancing performance and flexibility with hardware support for network architectures