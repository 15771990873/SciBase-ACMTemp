Managing battery lifetime with energy-aware adaptation