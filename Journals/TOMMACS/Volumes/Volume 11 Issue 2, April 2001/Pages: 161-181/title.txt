Achieving per-flow fair rate allocation in Diffserv