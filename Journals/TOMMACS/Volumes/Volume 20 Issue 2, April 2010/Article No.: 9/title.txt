Asymptotically optimal allocation of stratified sampling with adaptive variance reduction by strata