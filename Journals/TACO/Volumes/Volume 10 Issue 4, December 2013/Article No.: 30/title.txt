Automatic parallelization of fine-grained metafunctions on a chip multiprocessor