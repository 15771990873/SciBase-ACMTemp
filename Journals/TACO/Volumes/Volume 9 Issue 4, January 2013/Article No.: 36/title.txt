Compiler support for lightweight context switching