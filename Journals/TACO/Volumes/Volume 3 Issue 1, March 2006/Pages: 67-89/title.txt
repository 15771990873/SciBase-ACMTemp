Recovery code generation for general speculative optimizations