Staying Alive: System Design for Self-Sufficient Sensor Networks