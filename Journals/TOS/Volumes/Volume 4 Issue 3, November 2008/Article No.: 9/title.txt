Portably solving file races with hardness amplification