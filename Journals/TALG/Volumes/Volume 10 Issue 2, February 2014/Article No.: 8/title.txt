Dynamic programming for graphs on surfaces