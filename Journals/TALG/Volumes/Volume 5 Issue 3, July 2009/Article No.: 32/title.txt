Near-optimal algorithms for maximum constraint satisfaction problems