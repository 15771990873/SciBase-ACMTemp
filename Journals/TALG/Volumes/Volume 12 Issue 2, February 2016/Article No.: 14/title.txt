A New Approach to Incremental Cycle Detection and Related Problems