Hierarchical synopses with optimal error guarantees